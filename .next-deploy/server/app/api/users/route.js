(()=>{var e={};e.id=318,e.ids=[318],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},98406:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>q,routeModule:()=>x,serverHooks:()=>j,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{GET:()=>d,PUT:()=>l,dynamic:()=>c});var o=t(42706),a=t(28203),i=t(45994),n=t(39187),u=t(74069),p=t(91851);let c="force-dynamic";async function d(e){try{let r=await (0,p.getToken)({req:e});if(!r||r.role?.toUpperCase()!=="ADMIN")return n.NextResponse.json({error:"未授權訪問，僅管理員可以查看用戶列表"},{status:403});let t=(await u.z.user.findMany({orderBy:{createdAt:"desc"}})).map(e=>({id:e.id,name:e.name||"",email:e.email||"",role:e.role,image:e.image||"",createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}));return n.NextResponse.json(t)}catch(e){return console.error("獲取用戶列表時發生錯誤:",e),n.NextResponse.json({error:"獲取用戶列表失敗"},{status:500})}}async function l(e){try{let r=await (0,p.getToken)({req:e});if(!r||r.role?.toUpperCase()!=="ADMIN")return n.NextResponse.json({error:"未授權訪問，僅管理員可以更新用戶角色"},{status:403});let{id:t,role:s}=await e.json();if(!t||!s)return n.NextResponse.json({error:"缺少必要參數 id 或 role"},{status:400});if(!["user","masseur","admin"].includes(s))return n.NextResponse.json({error:"無效的角色"},{status:400});return await u.z.user.update({where:{id:t},data:{role:s}}),n.NextResponse.json({success:!0})}catch(e){return console.error("更新用戶角色時發生錯誤:",e),n.NextResponse.json({error:"更新用戶角色失敗"},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/users/route",pathname:"/api/users",filename:"route",bundlePath:"app/api/users/route"},resolvedPagePath:"D:\\projects\\10massage\\src\\app\\api\\users\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:g,serverHooks:j}=x;function q(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:g})}},96487:()=>{},78335:()=>{},74069:(e,r,t)=>{"use strict";t.d(r,{z:()=>o});var s=t(96330);let o=global.prisma||new s.PrismaClient({log:["error"]})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,452,851],()=>t(98406));module.exports=s})();