(()=>{var e={};e.id=257,e.ids=[257],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},21858:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>v,serverHooks:()=>f,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{DELETE:()=>j,GET:()=>l,PATCH:()=>g,POST:()=>x,PUT:()=>m,dynamic:()=>c});var o=t(42706),a=t(28203),n=t(45994),i=t(39187),u=t(74069),p=t(91851);let c="force-dynamic";async function l(){try{let e=(await u.z.masseur.findMany({include:{services:{select:{id:!0,name:!0}}},orderBy:[{sortOrder:"asc"},{createdAt:"desc"}]})).map(e=>{console.log("獲取按摩師原始數據:",e);let r={...e,imageUrl:e.image,imageScale:e.imageScale||1,cropX:e.cropX||0,cropY:e.cropY||0,cropWidth:e.cropWidth||300,cropHeight:e.cropHeight||225};return console.log("前端使用的按摩師數據:",r),r});return i.NextResponse.json(e)}catch(e){return console.error("獲取按摩師列表時發生錯誤:",e),i.NextResponse.json({error:"獲取按摩師列表失敗"},{status:500})}}async function d(e){let r=await (0,p.getToken)({req:e});return r?.role?.toUpperCase()==="ADMIN"}async function g(e){try{if(!await d(e))return i.NextResponse.json({error:"未授權訪問，僅管理員可以更新按摩師排序"},{status:403});let{masseurOrders:r}=await e.json();if(!Array.isArray(r))return i.NextResponse.json({error:"無效的請求數據"},{status:400});let t=r.map(({id:e,order:r})=>u.z.masseur.update({where:{id:e},data:{sortOrder:r}}));return await u.z.$transaction(t),console.log("按摩師排序已更新:",r),i.NextResponse.json({success:!0,message:"按摩師排序已更新"})}catch(e){return console.error("更新按摩師排序時發生錯誤:",e),i.NextResponse.json({error:"更新按摩師排序失敗"},{status:500})}}async function x(e){try{if(!await d(e))return i.NextResponse.json({error:"未授權訪問，僅管理員可以創建按摩師"},{status:403});let{name:r,description:t,imageUrl:s,imageScale:o,imageX:a,imageY:n,cropX:p,cropY:c,cropWidth:l,cropHeight:g}=await e.json(),x=await u.z.masseur.create({data:{name:r,description:t,image:s,...void 0!==o&&{imageScale:parseFloat(o.toString())},...void 0!==a&&{imageX:parseFloat(a.toString())},...void 0!==n&&{imageY:parseFloat(n.toString())},...void 0!==p&&{cropX:parseFloat(p.toString())},...void 0!==c&&{cropY:parseFloat(c.toString())},...void 0!==l&&{cropWidth:parseFloat(l.toString())},...void 0!==g&&{cropHeight:parseFloat(g.toString())}}});return i.NextResponse.json({id:x.id})}catch(e){return console.error("創建按摩師時發生錯誤:",e),i.NextResponse.json({error:"創建按摩師失敗"},{status:500})}}async function m(e){try{if(!await d(e))return i.NextResponse.json({error:"未授權訪問，僅管理員可以更新按摩師"},{status:403});let r=await e.json();console.log("接收到的原始更新數據:",r);let{id:t,name:s,description:o,imageUrl:a,imageScale:n,cropX:p,cropY:c,cropWidth:l,cropHeight:g}=r;if(!t)return i.NextResponse.json({error:"缺少按摩師ID"},{status:400});if(!s)return i.NextResponse.json({error:"按摩師名稱不能為空"},{status:400});if(console.log("處理後的更新數據:",{id:t,name:s,description:o,imageUrl:a,imageScale:n,cropX:p,cropY:c,cropWidth:l,cropHeight:g}),!await u.z.masseur.findUnique({where:{id:t}}))return i.NextResponse.json({error:"找不到按摩師"},{status:404});let x={name:s,description:o||null};void 0!==a&&(x.image=a),void 0!==n&&(x.imageScale=parseFloat(String(n))),void 0!==p&&(x.cropX=parseFloat(String(p))),void 0!==c&&(x.cropY=parseFloat(String(c))),void 0!==l&&(x.cropWidth=parseFloat(String(l))),void 0!==g&&(x.cropHeight=parseFloat(String(g))),console.log("最終更新數據:",x);let m=await u.z.masseur.update({where:{id:t},data:x});return console.log("按摩師更新成功:",m),i.NextResponse.json({success:!0,masseur:{...m,imageUrl:m.image}})}catch(e){return console.error("更新按摩師時發生錯誤:",e),i.NextResponse.json({error:"更新按摩師失敗"},{status:500})}}async function j(e){try{if(!await d(e))return i.NextResponse.json({error:"未授權訪問，僅管理員可以刪除按摩師"},{status:403});let{id:r}=await e.json();if(!r)return i.NextResponse.json({error:"缺少按摩師 ID"},{status:400});return await u.z.masseur.delete({where:{id:r}}),i.NextResponse.json({success:!0})}catch(e){return console.error("刪除按摩師時發生錯誤:",e),i.NextResponse.json({error:"刪除按摩師失敗"},{status:500})}}let v=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/masseurs/route",pathname:"/api/masseurs",filename:"route",bundlePath:"app/api/masseurs/route"},resolvedPagePath:"D:\\projects\\10massage\\src\\app\\api\\masseurs\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:w,serverHooks:f}=v;function y(){return(0,n.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:w})}},96487:()=>{},78335:()=>{},74069:(e,r,t)=>{"use strict";t.d(r,{z:()=>o});var s=t(96330);let o=global.prisma||new s.PrismaClient({log:["error"]})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,452,851],()=>t(21858));module.exports=s})();