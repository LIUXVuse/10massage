(()=>{var e={};e.id=438,e.ids=[438],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},79029:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>R,routeModule:()=>w,serverHooks:()=>f,workAsyncStorage:()=>j,workUnitAsyncStorage:()=>y});var s={};t.r(s),t.d(s,{DELETE:()=>v,GET:()=>l,POST:()=>x,PUT:()=>m,dynamic:()=>p});var n=t(42706),a=t(28203),o=t(45994),i=t(39187),u=t(74069),c=t(91851);let p="force-dynamic";async function d(e){let r=await (0,c.getToken)({req:e});return r?.role==="ADMIN"||r?.role?.toUpperCase()==="ADMIN"}async function l(){try{let e=await u.z.service.findMany({include:{masseurs:{select:{id:!0,name:!0,image:!0}}},orderBy:{createdAt:"desc"}});return i.NextResponse.json(e)}catch(e){return console.error("獲取服務列表失敗:",e),i.NextResponse.json({error:"獲取服務列表失敗"},{status:500})}}async function x(e){try{if(!await d(e))return i.NextResponse.json({error:"未授權訪問，僅管理員可以創建服務"},{status:403});let{name:r,description:t,price:s,duration:n,type:a,category:o,isRecommended:c,masseurs:p}=await e.json(),l=await u.z.service.create({data:{name:r,description:t,price:parseFloat(s),duration:parseInt(n),type:a||"general",category:o||"massage",isRecommend:c||!1,masseurs:{connect:p?.map(e=>({id:e.id}))||[]}}});return i.NextResponse.json(l)}catch(e){return console.error("創建服務失敗:",e),i.NextResponse.json({error:"創建服務失敗"},{status:500})}}async function m(e){try{if(!await d(e))return i.NextResponse.json({error:"未授權訪問，僅管理員可以更新服務"},{status:403});let{id:r,name:t,description:s,price:n,duration:a,type:o,category:c,isRecommended:p,masseurs:l}=await e.json(),x=await u.z.service.findUnique({where:{id:r},include:{masseurs:!0}});if(!x)return i.NextResponse.json({error:"找不到服務"},{status:404});let m=await u.z.service.update({where:{id:r},data:{name:t,description:s,price:parseFloat(n),duration:parseInt(a),type:o,category:c,isRecommend:p,masseurs:{disconnect:x.masseurs.map(e=>({id:e.id})),connect:l?.map(e=>({id:e.id}))||[]}}});return i.NextResponse.json(m)}catch(e){return console.error("更新服務失敗:",e),i.NextResponse.json({error:"更新服務失敗"},{status:500})}}async function v(e){try{if(!await d(e))return i.NextResponse.json({error:"未授權訪問，僅管理員可以刪除服務"},{status:403});let{searchParams:r}=new URL(e.url),t=r.get("id");if(!t)return i.NextResponse.json({error:"缺少服務 ID"},{status:400});return await u.z.service.update({where:{id:t},data:{masseurs:{disconnect:[]}}}),await u.z.service.delete({where:{id:t}}),i.NextResponse.json({success:!0})}catch(e){return console.error("刪除服務失敗:",e),i.NextResponse.json({error:"刪除服務失敗"},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/services/route",pathname:"/api/services",filename:"route",bundlePath:"app/api/services/route"},resolvedPagePath:"D:\\projects\\10massage\\src\\app\\api\\services\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:j,workUnitAsyncStorage:y,serverHooks:f}=w;function R(){return(0,o.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:y})}},96487:()=>{},78335:()=>{},74069:(e,r,t)=>{"use strict";t.d(r,{z:()=>n});var s=t(96330);let n=global.prisma||new s.PrismaClient({log:["error"]})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,452,851],()=>t(79029));module.exports=s})();