(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[809],{1199:(e,t,n)=>{Promise.resolve().then(n.bind(n,5963))},6046:(e,t,n)=>{"use strict";var r=n(6658);n.o(r,"redirect")&&n.d(t,{redirect:function(){return r.redirect}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},5963:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>el});var r,s=n(5155),i=n(2115),a=n(2615),o=n(6046),l=n(8291);function d(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}let c={data:""},u=e=>"object"==typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||c,p=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,m=/\/\*[^]*?\*\/|  +/g,f=/\n+/g,x=(e,t)=>{let n="",r="",s="";for(let i in e){let a=e[i];"@"==i[0]?"i"==i[1]?n=i+" "+a+";":r+="f"==i[1]?x(a,i):i+"{"+x(a,"k"==i[1]?"":t)+"}":"object"==typeof a?r+=x(a,t?t.replace(/([^,])+/g,e=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)):i):null!=a&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),s+=x.p?x.p(i,a):i+":"+a+";")}return n+(t&&s?t+"{"+s+"}":s)+r},h={},g=e=>{if("object"==typeof e){let t="";for(let n in e)t+=n+g(e[n]);return t}return e},b=(e,t,n,r,s)=>{let i=g(e),a=h[i]||(h[i]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(i));if(!h[a]){let t=i!==e?e:(e=>{let t,n,r=[{}];for(;t=p.exec(e.replace(m,""));)t[4]?r.shift():t[3]?(n=t[3].replace(f," ").trim(),r.unshift(r[0][n]=r[0][n]||{})):r[0][t[1]]=t[2].replace(f," ").trim();return r[0]})(e);h[a]=x(s?{["@keyframes "+a]:t}:t,n?"":"."+a)}let o=n&&h.g?h.g:null;return n&&(h.g=h[a]),((e,t,n,r)=>{r?t.data=t.data.replace(r,e):-1===t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)})(h[a],t,r,o),a},y=(e,t,n)=>e.reduce((e,r,s)=>{let i=t[s];if(i&&i.call){let e=i(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;i=t?"."+t:e&&"object"==typeof e?e.props?"":x(e,""):!1===e?"":e}return e+r+(null==i?"":i)},"");function v(e){let t=this||{},n=e.call?e(t.p):e;return b(n.unshift?n.raw?y(n,[].slice.call(arguments,1),t.p):n.reduce((e,n)=>Object.assign(e,n&&n.call?n(t.p):n),{}):n,u(t.target),t.g,t.o,t.k)}v.bind({g:1});let w,j,N,k=v.bind({k:1});function C(e,t){let n=this||{};return function(){let r=arguments;function s(i,a){let o=Object.assign({},i),l=o.className||s.className;n.p=Object.assign({theme:j&&j()},o),n.o=/ *go\d+/.test(l),o.className=v.apply(n,r)+(l?" "+l:""),t&&(o.ref=a);let d=e;return e[0]&&(d=o.as||e,delete o.as),N&&d[0]&&N(o),w(d,o)}return t?t(s):s}}function S(){let e=d(["\nfrom {\n  transform: scale(0) rotate(45deg);\n	opacity: 0;\n}\nto {\n transform: scale(1) rotate(45deg);\n  opacity: 1;\n}"]);return S=function(){return e},e}function A(){let e=d(["\nfrom {\n  transform: scale(0);\n  opacity: 0;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]);return A=function(){return e},e}function E(){let e=d(["\nfrom {\n  transform: scale(0) rotate(90deg);\n	opacity: 0;\n}\nto {\n  transform: scale(1) rotate(90deg);\n	opacity: 1;\n}"]);return E=function(){return e},e}function O(){let e=d(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n\n  &:after,\n  &:before {\n    content: '';\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 150ms;\n    position: absolute;\n    border-radius: 3px;\n    opacity: 0;\n    background: ",";\n    bottom: 9px;\n    left: 4px;\n    height: 2px;\n    width: 12px;\n  }\n\n  &:before {\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 180ms;\n    transform: rotate(90deg);\n  }\n"]);return O=function(){return e},e}function U(){let e=d(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]);return U=function(){return e},e}function _(){let e=d(["\n  width: 12px;\n  height: 12px;\n  box-sizing: border-box;\n  border: 2px solid;\n  border-radius: 100%;\n  border-color: ",";\n  border-right-color: ",";\n  animation: "," 1s linear infinite;\n"]);return _=function(){return e},e}function z(){let e=d(["\nfrom {\n  transform: scale(0) rotate(45deg);\n	opacity: 0;\n}\nto {\n  transform: scale(1) rotate(45deg);\n	opacity: 1;\n}"]);return z=function(){return e},e}function I(){let e=d(["\n0% {\n	height: 0;\n	width: 0;\n	opacity: 0;\n}\n40% {\n  height: 0;\n	width: 6px;\n	opacity: 1;\n}\n100% {\n  opacity: 1;\n  height: 10px;\n}"]);return I=function(){return e},e}function M(){let e=d(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n  &:after {\n    content: '';\n    box-sizing: border-box;\n    animation: "," 0.2s ease-out forwards;\n    opacity: 0;\n    animation-delay: 200ms;\n    position: absolute;\n    border-right: 2px solid;\n    border-bottom: 2px solid;\n    border-color: ",";\n    bottom: 6px;\n    left: 6px;\n    height: 10px;\n    width: 6px;\n  }\n"]);return M=function(){return e},e}function D(){let e=d(["\n  position: absolute;\n"]);return D=function(){return e},e}function R(){let e=d(["\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: 20px;\n  min-height: 20px;\n"]);return R=function(){return e},e}function q(){let e=d(["\nfrom {\n  transform: scale(0.6);\n  opacity: 0.4;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]);return q=function(){return e},e}function F(){let e=d(["\n  position: relative;\n  transform: scale(0.6);\n  opacity: 0.4;\n  min-width: 20px;\n  animation: "," 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n"]);return F=function(){return e},e}function P(){let e=d(["\n  display: flex;\n  align-items: center;\n  background: #fff;\n  color: #363636;\n  line-height: 1.3;\n  will-change: transform;\n  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);\n  max-width: 350px;\n  pointer-events: auto;\n  padding: 8px 10px;\n  border-radius: 8px;\n"]);return P=function(){return e},e}function T(){let e=d(["\n  display: flex;\n  justify-content: center;\n  margin: 4px 10px;\n  color: inherit;\n  flex: 1 1 auto;\n  white-space: pre-line;\n"]);return T=function(){return e},e}function L(){let e=d(["\n  z-index: 9999;\n  > * {\n    pointer-events: auto;\n  }\n"]);return L=function(){return e},e}var H=e=>"function"==typeof e,J=(e,t)=>H(e)?e(t):e,Z=(()=>{let e=0;return()=>(++e).toString()})(),$=((()=>{let e;return()=>{if(void 0===e&&"u">typeof window){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),(e,t)=>{switch(t.type){case 0:return{...e,toasts:[t.toast,...e.toasts].slice(0,20)};case 1:return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case 2:let{toast:n}=t;return $(e,{type:e.toasts.find(e=>e.id===n.id)?1:0,toast:n});case 3:let{toastId:r}=t;return{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,dismissed:!0,visible:!1}:e)};case 4:return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)};case 5:return{...e,pausedAt:t.time};case 6:let s=t.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(e=>({...e,pauseDuration:e.pauseDuration+s}))}}}),B=[],G={toasts:[],pausedAt:void 0},K=e=>{G=$(G,e),B.forEach(e=>{e(G)})},Q={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},V=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blank",n=arguments.length>2?arguments[2]:void 0;return{createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...n,id:(null==n?void 0:n.id)||Z()}},W=e=>(t,n)=>{let r=V(t,e,n);return K({type:2,toast:r}),r.id},X=(e,t)=>W("blank")(e,t);X.error=W("error"),X.success=W("success"),X.loading=W("loading"),X.custom=W("custom"),X.dismiss=e=>{K({type:3,toastId:e})},X.remove=e=>K({type:4,toastId:e}),X.promise=(e,t,n)=>{let r=X.loading(t.loading,{...n,...null==n?void 0:n.loading});return"function"==typeof e&&(e=e()),e.then(e=>{let s=t.success?J(t.success,e):void 0;return s?X.success(s,{id:r,...n,...null==n?void 0:n.success}):X.dismiss(r),e}).catch(e=>{let s=t.error?J(t.error,e):void 0;s?X.error(s,{id:r,...n,...null==n?void 0:n.error}):X.dismiss(r)}),e};var Y=new Map,ee=k(S()),et=k(A()),en=k(E()),er=(C("div")(O(),e=>e.primary||"#ff4b4b",ee,et,e=>e.secondary||"#fff",en),k(U())),es=(C("div")(_(),e=>e.secondary||"#e0e0e0",e=>e.primary||"#616161",er),k(z())),ei=k(I()),ea=(C("div")(M(),e=>e.primary||"#61d345",es,ei,e=>e.secondary||"#fff"),C("div")(D()),C("div")(R()),k(q()));function eo(){let[e,t]=(0,i.useState)([]),[n,r]=(0,i.useState)(!0),[a,o]=(0,i.useState)(null),l=async()=>{try{r(!0);let e=await fetch("/api/users");if(!e.ok)throw Error("獲取用戶列表失敗");let n=await e.json();t(n)}catch(e){console.error("獲取用戶列表錯誤:",e),X.error("獲取用戶列表失敗")}finally{r(!1)}},d=async(n,r)=>{try{if(o(n),!(await fetch("/api/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n,role:r})})).ok)throw Error("更新用戶角色失敗");t(e.map(e=>e.id===n?{...e,role:r}:e)),X.success("用戶角色已更新")}catch(e){console.error("更新用戶角色錯誤:",e),X.error("更新用戶角色失敗")}finally{o(null)}};return(0,i.useEffect)(()=>{l()},[]),(0,s.jsx)("div",{children:(0,s.jsx)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"用戶名"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"電子郵件"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"目前角色"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"設定角色"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:4,className:"px-6 py-4 whitespace-nowrap text-center",children:"載入中..."})}):0===e.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:4,className:"px-6 py-4 whitespace-nowrap text-center",children:"沒有用戶數據"})}):e.map(e=>{var t,n,r,i,o,l;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"flex items-center",children:[e.image?(0,s.jsx)("img",{className:"h-10 w-10 rounded-full mr-3",src:e.image,alt:e.name}):(0,s.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 mr-3 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-gray-500",children:(null===(n=e.name)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.toUpperCase())||"?"})}),(0,s.jsx)("div",{className:"ml-4",children:(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name||"未命名"})})]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("div",{className:"text-sm text-gray-900",children:e.email})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \n                      ".concat((null===(r=e.role)||void 0===r?void 0:r.toUpperCase())==="ADMIN"?"bg-purple-100 text-purple-800":(null===(i=e.role)||void 0===i?void 0:i.toUpperCase())==="MASSEUR"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:(null===(o=e.role)||void 0===o?void 0:o.toUpperCase())==="ADMIN"?"管理員":(null===(l=e.role)||void 0===l?void 0:l.toUpperCase())==="MASSEUR"?"按摩師":"一般用戶"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,s.jsxs)("select",{value:e.role,onChange:t=>d(e.id,t.target.value),disabled:a===e.id,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[(0,s.jsx)("option",{value:"user",children:"一般用戶"}),(0,s.jsx)("option",{value:"masseur",children:"按摩師"}),(0,s.jsx)("option",{value:"admin",children:"管理員"})]})})]},e.id)})})]})})})}function el(){let{data:e}=(0,a.useSession)({required:!0,onUnauthenticated(){(0,o.redirect)("/login")}}),t=(0,l.q)(e);return(0,i.useEffect)(()=>{t||(0,o.redirect)("/dashboard")},[t]),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"用戶管理"}),(0,s.jsx)("p",{className:"text-gray-600",children:"管理系統中的所有用戶和角色分配"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"角色說明"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,s.jsx)("div",{className:"text-lg font-medium mb-1 text-blue-600",children:"一般用戶"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"只能查看和預約服務，管理個人資料。"})]}),(0,s.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,s.jsx)("div",{className:"text-lg font-medium mb-1 text-green-600",children:"按摩師"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"可以查看預約情況並管理自己的排程。"})]}),(0,s.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,s.jsx)("div",{className:"text-lg font-medium mb-1 text-purple-600",children:"管理員"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"可以進行系統全部設定，管理用戶、服務和按摩師。"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"用戶列表"}),(0,s.jsx)(eo,{})]})]})}C("div")(F(),ea),C("div")(P()),C("div")(T()),r=i.createElement,x.p=void 0,w=r,j=void 0,N=void 0,v(L())},8291:(e,t,n)=>{"use strict";function r(e){var t,n;return(null==e?void 0:null===(n=e.user)||void 0===n?void 0:null===(t=n.role)||void 0===t?void 0:t.toUpperCase())==="ADMIN"}n.d(t,{q:()=>r})}},e=>{var t=t=>e(e.s=t);e.O(0,[615,441,517,358],()=>t(1199)),_N_E=e.O()}]);