(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[158],{7542:(e,t,s)=>{Promise.resolve().then(s.bind(s,232))},232:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var r=s(5155),i=s(2115),a=s(3312);function n(e){let{open:t=!1,onOpenChange:s,onConfirm:n,onCancel:l,title:d,description:o,confirmText:c="確認",cancelText:u="取消"}=e,[m,h]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{h(t)},[t]),m)?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:d}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:o}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)(a.$,{variant:"outline",onClick:()=>{l&&l(),s&&s(!1),h(!1)},children:u}),(0,r.jsx)(a.$,{variant:"destructive",onClick:()=>{n(),s&&s(!1),h(!1)},children:c})]})]})}):null}var l=s(5565),d=s(2615),o=s(6046),c=s(8291),u=s(1812),m=s(3561),h=s(6329),x=s(5256),f=s(2783),p=s(5088),g=s(8173),v=s.n(g);function b(e){let{masseur:t,userIsAdmin:s,onDelete:i}=e,{attributes:a,listeners:n,setNodeRef:d,transform:o,transition:c,isDragging:u}=(0,m.gl)({id:t.id}),f={transform:h.Ks.Transform.toString(o),transition:c,zIndex:u?10:1,opacity:u?.8:1};return(0,r.jsxs)("div",{ref:d,style:f,className:"bg-white p-4 rounded-lg shadow relative group ".concat(u?"ring-2 ring-primary shadow-lg":""),children:[s&&(0,r.jsx)("div",{className:"absolute top-2 left-2 cursor-grab opacity-30 group-hover:opacity-100 transition-opacity",...a,...n,children:(0,r.jsx)(x.A,{className:"h-6 w-6 text-gray-500"})}),(0,r.jsx)("div",{className:"relative h-40 w-full rounded-md overflow-hidden mb-3",children:t.imageUrl?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.default,{src:t.imageUrl,alt:t.name,fill:!0,style:{objectFit:"contain",backgroundColor:"#f3f4f6"},className:"transition-all duration-300",priority:!0,loading:"eager",onLoad:e=>{console.log("圖片載入完成",{masseurId:t.id,name:t.name,imageUrl:t.imageUrl,naturalWidth:e.target.naturalWidth,naturalHeight:e.target.naturalHeight})},onError:e=>{console.error("圖片載入錯誤",{masseurId:t.id,imageUrl:t.imageUrl,error:e})}})}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full bg-gray-100",children:(0,r.jsx)("span",{className:"text-gray-400",children:"無圖片"})})}),(0,r.jsx)("h3",{className:"font-semibold text-lg mb-1",children:t.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2 h-10",children:t.description||"無自我介紹"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mb-3",children:[t.services&&t.services.length>0?t.services.slice(0,3).map(e=>(0,r.jsx)("span",{className:"inline-block text-xs px-2 py-1 bg-blue-50 text-blue-700 rounded-full",children:e.name},e.id)):(0,r.jsx)("span",{className:"text-xs text-gray-400",children:"未提供服務"}),t.services&&t.services.length>3&&(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["+",t.services.length-3,"種服務"]})]}),s&&(0,r.jsxs)("div",{className:"flex justify-between mt-3 pt-3 border-t border-gray-100",children:[(0,r.jsx)(v(),{href:"/masseurs/edit/".concat(t.id),className:"text-xs inline-flex items-center px-2.5 py-1.5 rounded-md font-medium bg-blue-50 text-blue-700 hover:bg-blue-100 transition-colors",children:"編輯"}),(0,r.jsx)("button",{onClick:()=>i(t),className:"text-xs inline-flex items-center px-2.5 py-1.5 rounded-md font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:"刪除"})]})]})}function y(){let{data:e,status:t}=(0,d.useSession)({required:!0,onUnauthenticated(){(0,o.redirect)("/login")}}),s=(0,c.q)(e),[l,h]=(0,i.useState)([]),[x,g]=(0,i.useState)([]),[y,j]=(0,i.useState)(null),[w,N]=(0,i.useState)(!1),[S,T]=(0,i.useState)(!0),[E,A]=(0,i.useState)(!1),_=(0,u.FR)((0,u.MS)(u.AN,{activationConstraint:{distance:5}}),(0,u.MS)(u.uN,{coordinateGetter:m.JR}));(0,i.useEffect)(()=>{"authenticated"===t&&(I(),O())},[t]);let I=async()=>{try{T(!0);let e=await fetch("/api/masseurs"),t=await e.json();h(t)}catch(e){console.error("獲取按摩師列表時發生錯誤:",e),(0,p.o)({title:"錯誤",description:"獲取按摩師列表失敗",variant:"destructive"})}finally{T(!1)}},O=async()=>{try{let e=await fetch("/api/services"),t=await e.json();g(t)}catch(e){console.error("獲取服務列表時發生錯誤:",e)}},k=async()=>{if(y)try{if(!(await fetch("/api/masseurs",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:y.id})})).ok)throw Error("刪除按摩師失敗");h(e=>e.filter(e=>e.id!==y.id)),(0,p.o)({title:"成功",description:"按摩師已成功刪除"})}catch(e){console.error("刪除按摩師時發生錯誤:",e),(0,p.o)({title:"錯誤",description:"刪除按摩師失敗",variant:"destructive"})}finally{j(null),N(!1)}},D=async e=>{let{active:t,over:s}=e;s&&t.id!==s.id&&(h(e=>{let r=e.findIndex(e=>e.id===t.id),i=e.findIndex(e=>e.id===s.id);return(0,p.o)({title:"正在更新排序",description:"正在保存新的按摩師排序...",duration:2e3}),(0,m.be)(e,r,i)}),await C())},C=async()=>{if(s){A(!0);try{let e=l.map((e,t)=>({id:e.id,order:t+1}));if(!(await fetch("/api/masseurs",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({masseurOrders:e})})).ok)throw Error("更新排序失敗");(0,p.o)({title:"排序已更新",description:"按摩師排序已成功保存，下次登入時將保持此排序",duration:3e3})}catch(e){console.error("保存排序時發生錯誤:",e),(0,p.o)({title:"排序更新失敗",description:"無法保存按摩師排序，請稍後再試",variant:"destructive",duration:5e3})}finally{A(!1)}}},M=e=>{j(e),N(!0)};return(0,r.jsxs)("div",{className:"p-6 relative",children:[E&&(0,r.jsx)("div",{className:"absolute inset-0 bg-white/50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-lg flex items-center space-x-3",children:[(0,r.jsx)(f.A,{className:"h-6 w-6 text-primary animate-spin"}),(0,r.jsx)("span",{className:"text-gray-700 font-medium",children:"正在保存排序..."})]})}),(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"按摩師管理"}),s&&(0,r.jsx)("div",{children:(0,r.jsx)(v(),{href:"/masseurs/edit/new",children:(0,r.jsx)(a.$,{children:"新增按摩師"})})})]}),s&&(0,r.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-blue-700 flex items-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),(0,r.jsxs)("span",{children:[(0,r.jsx)("strong",{children:"排序提示："})," 您可以通過拖放按摩師卡片來調整顯示順序。點擊並按住卡片左上角的拖動圖標，然後拖動到所需位置。排序會自動保存，下次登入時仍會保持此順序。"]})]}),S?(0,r.jsxs)("div",{className:"flex justify-center items-center min-h-[400px]",children:[(0,r.jsx)(f.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,r.jsx)("span",{className:"ml-3 text-lg",children:"載入中..."})]}):0===l.length?(0,r.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-sm text-center",children:[(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:"尚未新增任何按摩師"}),s&&(0,r.jsx)(v(),{href:"/masseurs/edit/new",children:(0,r.jsx)(a.$,{children:"新增第一位按摩師"})})]}):(0,r.jsx)(u.Mp,{sensors:_,collisionDetection:u.fp,onDragEnd:D,children:(0,r.jsx)(m.gB,{items:l.map(e=>e.id),strategy:m._G,children:(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:l.map(e=>(0,r.jsx)(b,{masseur:e,userIsAdmin:s,onDelete:M},e.id))})})}),(0,r.jsx)(n,{open:!!y&&w,onOpenChange:()=>{N(!1),j(null)},onConfirm:k,title:"確認刪除",description:"您確定要刪除按摩師「".concat(null==y?void 0:y.name,"」嗎？此操作無法撤銷。")})]})}},3312:(e,t,s)=>{"use strict";s.d(t,{$:()=>o});var r=s(5155),i=s(2115),a=s(2317),n=s(1027),l=s(1567);let d=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),o=i.forwardRef((e,t)=>{let{className:s,variant:i,size:n,asChild:o=!1,...c}=e,u=o?a.DX:"button";return(0,r.jsx)(u,{className:(0,l.cn)(d({variant:i,size:n,className:s})),ref:t,...c})});o.displayName="Button"},5088:(e,t,s)=>{"use strict";s.d(t,{d:()=>m,o:()=>u});var r=s(2115);let i=0,a=new Map,n=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,5)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?c(s):e.toasts.forEach(e=>{c(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],d={toasts:[]};function o(e){d=n(d,e),l.forEach(e=>{e(d)})}function c(e){if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)}function u(e){let{variant:t="default",title:s,description:r,duration:a=5e3,action:n}=e,l=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString();return o({type:"ADD_TOAST",toast:{id:l,title:s,description:r,variant:t,duration:a,action:n}}),{id:l,dismiss:()=>o({type:"DISMISS_TOAST",toastId:l}),update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:l}})}}function m(){let[e,t]=r.useState(d);return r.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[]),{...e,toast:u,dismiss:e=>o({type:"DISMISS_TOAST",toastId:e})}}},8291:(e,t,s)=>{"use strict";function r(e){var t,s;return(null==e?void 0:null===(s=e.user)||void 0===s?void 0:null===(t=s.role)||void 0===t?void 0:t.toUpperCase())==="ADMIN"}s.d(t,{q:()=>r})},1567:(e,t,s)=>{"use strict";s.d(t,{cn:()=>a});var r=s(3463),i=s(9795);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,r.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[374,615,130,635,544,441,517,358],()=>t(7542)),_N_E=e.O()}]);