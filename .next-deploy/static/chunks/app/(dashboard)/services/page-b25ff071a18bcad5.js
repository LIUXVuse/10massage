(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{3755:(e,s,r)=>{Promise.resolve().then(r.bind(r,5082))},5082:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>M});var i=r(5155),a=r(2115),t=r(9606),n=r(2679),l=r(3415),d=r(3312),c=r(3900),o=r(6754),m=r(8986),u=r(1470),x=r(1703),f=r(1567);let h=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,i.jsx)(u.bL,{className:(0,f.cn)("grid gap-2",r),...a,ref:s})});h.displayName=u.bL.displayName;let p=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,i.jsx)(u.q7,{ref:s,className:(0,f.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...a,children:(0,i.jsx)(u.C1,{className:"flex items-center justify-center",children:(0,i.jsx)(x.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});p.displayName=u.q7.displayName;var v=r(5524),g=r(2413);let b=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,i.jsx)(g.bL,{className:(0,f.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...a,ref:s,children:(0,i.jsx)(g.zi,{className:(0,f.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});b.displayName=g.bL.displayName;let j=l.Ik({name:l.Yj().min(1,"名稱為必填"),description:l.Yj().min(1,"描述為必填"),type:l.k5(["SINGLE","COMBO"]),category:l.k5(["MASSAGE","CARE","TREATMENT"]),isRecommended:l.zM(),recommendOrder:l.ai().min(0),durations:l.YO(l.Ik({duration:l.ai().min(1,"時長為必填"),price:l.ai().min(1,"價格為必填")})).min(1,"至少需要一個時長"),masseurs:l.YO(l.Ik({id:l.Yj()})).min(1,"至少需要一個按摩師")});function y(e){let{initialData:s,masseurs:r,onSubmit:l}=e,[u,x]=(0,a.useState)((null==s?void 0:s.durations)||[{duration:0,price:0}]),{register:f,handleSubmit:g,formState:{errors:y},setValue:N,watch:w}=(0,t.mN)({resolver:(0,n.u)(j),defaultValues:s||{type:"SINGLE",category:"MASSAGE",isRecommended:!1,recommendOrder:0,masseurs:[]}}),E=w("masseurs")||[],k=w("isRecommended"),A=e=>{let s=u.filter((s,r)=>r!==e);x(s),N("durations",s)},S=(e,s,r)=>{let i=[...u];i[e][s]=Number(r),x(i),N("durations",i)},R=e=>{E.some(s=>s.id===e)?N("masseurs",E.filter(s=>s.id!==e)):N("masseurs",[...E,{id:e}])};return(0,i.jsxs)("form",{onSubmit:g(l),className:"space-y-6",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(m.J,{htmlFor:"name",children:"服務名稱"}),(0,i.jsx)(c.p,{id:"name",...f("name")}),y.name&&(0,i.jsx)("p",{className:"text-sm text-red-500",children:y.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(m.J,{htmlFor:"description",children:"服務描述"}),(0,i.jsx)(o.T,{id:"description",...f("description")}),y.description&&(0,i.jsx)("p",{className:"text-sm text-red-500",children:y.description.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(m.J,{children:"服務類型"}),(0,i.jsxs)(h,{defaultValue:(null==s?void 0:s.type)||"SINGLE",onValueChange:e=>N("type",e),children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(p,{value:"SINGLE",id:"single"}),(0,i.jsx)(m.J,{htmlFor:"single",children:"單人服務"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(p,{value:"COMBO",id:"combo"}),(0,i.jsx)(m.J,{htmlFor:"combo",children:"組合服務"})]})]}),y.type&&(0,i.jsx)("p",{className:"text-sm text-red-500",children:y.type.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(m.J,{children:"服務分類"}),(0,i.jsxs)(h,{defaultValue:(null==s?void 0:s.category)||"MASSAGE",onValueChange:e=>N("category",e),children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(p,{value:"MASSAGE",id:"massage"}),(0,i.jsx)(m.J,{htmlFor:"massage",children:"按摩"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(p,{value:"CARE",id:"care"}),(0,i.jsx)(m.J,{htmlFor:"care",children:"護理"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(p,{value:"TREATMENT",id:"treatment"}),(0,i.jsx)(m.J,{htmlFor:"treatment",children:"療程"})]})]}),y.category&&(0,i.jsx)("p",{className:"text-sm text-red-500",children:y.category.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(m.J,{htmlFor:"isRecommended",children:"設為推薦服務"}),(0,i.jsx)(b,{id:"isRecommended",checked:k,onCheckedChange:e=>N("isRecommended",e)})]}),k&&(0,i.jsxs)("div",{className:"mt-2",children:[(0,i.jsx)(m.J,{htmlFor:"recommendOrder",children:"推薦排序"}),(0,i.jsx)(c.p,{id:"recommendOrder",type:"number",min:"0",...f("recommendOrder",{valueAsNumber:!0})}),y.recommendOrder&&(0,i.jsx)("p",{className:"text-sm text-red-500",children:y.recommendOrder.message})]})]}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(m.J,{children:"服務時長與價格"}),u.map((e,s)=>(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)(c.p,{type:"number",placeholder:"時長(分鐘)",value:e.duration,onChange:e=>S(s,"duration",e.target.value)})}),(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)(c.p,{type:"number",placeholder:"價格",value:e.price,onChange:e=>S(s,"price",e.target.value)})}),(0,i.jsx)(d.$,{type:"button",variant:"destructive",size:"icon",onClick:()=>A(s),children:(0,i.jsx)(v.A,{className:"h-4 w-4"})})]},s)),(0,i.jsx)(d.$,{type:"button",variant:"outline",onClick:()=>{x([...u,{duration:0,price:0}])},children:"新增時長"}),y.durations&&(0,i.jsx)("p",{className:"text-sm text-red-500",children:y.durations.message})]}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(m.J,{children:"選擇按摩師"}),(0,i.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:r.map(e=>(0,i.jsx)("div",{className:"p-4 border rounded-lg cursor-pointer ".concat(E.some(s=>s.id===e.id)?"border-primary bg-primary/10":""),onClick:()=>R(e.id),children:e.name},e.id))}),y.masseurs&&(0,i.jsx)("p",{className:"text-sm text-red-500",children:y.masseurs.message})]}),(0,i.jsx)(d.$,{type:"submit",className:"w-full",children:s?"更新服務":"新增服務"})]})}var N=r(4683),w=r(5686);let E=(0,r(1027).F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function k(e){let{className:s,variant:r,...a}=e;return(0,i.jsx)("div",{className:(0,f.cn)(E({variant:r}),s),...a})}var A=r(2615),S=r(6046),R=r(8291);let C={MASSAGE:"按摩",CARE:"護理",TREATMENT:"療程"},O={MASSAGE:"bg-blue-100 text-blue-800",CARE:"bg-green-100 text-green-800",TREATMENT:"bg-purple-100 text-purple-800"};function M(){var e;let{data:s}=(0,A.useSession)({required:!0,onUnauthenticated(){(0,S.redirect)("/login")}});console.log("SESSION DATA:",s);let r=(0,R.q)(s);console.log("IS ADMIN:",r,"ROLE:",null==s?void 0:null===(e=s.user)||void 0===e?void 0:e.role);let[t,n]=(0,a.useState)([]),[l,c]=(0,a.useState)([]),[o,m]=(0,a.useState)(!1),[u,x]=(0,a.useState)(null),[f,h]=(0,a.useState)("ALL");(0,a.useEffect)(()=>{p(),g()},[]);let p=async()=>{try{let e=await fetch("/api/services");if(!e.ok)throw Error("Failed to fetch services");let s=await e.json();n(s)}catch(e){console.error("Error fetching services:",e)}},g=async()=>{try{let e=await fetch("/api/masseurs");if(!e.ok)throw Error("Failed to fetch masseurs");let s=await e.json();c(s)}catch(e){console.error("Error fetching masseurs:",e)}},b=async e=>{try{let s=u?"/api/services/".concat(u.id):"/api/services",r=u?"PUT":"POST";if(!(await fetch(s,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to save service");m(!1),x(null),p()}catch(e){console.error("Error saving service:",e)}},j=async e=>{if(r&&confirm("確定要刪除這個服務嗎？"))try{if(!(await fetch("/api/services/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete service");p()}catch(e){console.error("Error deleting service:",e)}},E=e=>{r&&(x(e),m(!0))},M=[..."ALL"===f?t:"RECOMMENDED"===f?t.filter(e=>e.isRecommended):t.filter(e=>e.category===f)].sort((e,s)=>e.isRecommended&&s.isRecommended?e.recommendOrder-s.recommendOrder:e.isRecommended?-1:s.isRecommended?1:0);if(o){let e=u?{...u,masseurs:u.masseurs.map(e=>({id:e.masseur.id}))}:void 0;return(0,i.jsxs)("div",{className:"container mx-auto p-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold",children:u?"編輯服務":"新增服務"}),(0,i.jsx)(d.$,{variant:"outline",onClick:()=>{m(!1),x(null)},children:"返回"})]}),(0,i.jsx)(y,{initialData:e,masseurs:l,onSubmit:b})]})}return(0,i.jsxs)("div",{className:"container mx-auto p-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold",children:"服務列表"}),r&&(0,i.jsxs)(d.$,{onClick:()=>m(!0),children:[(0,i.jsx)(N.A,{className:"mr-2 h-4 w-4"})," 新增服務"]})]}),(0,i.jsxs)("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:[(0,i.jsx)(d.$,{variant:"ALL"===f?"default":"outline",onClick:()=>h("ALL"),children:"全部"}),(0,i.jsx)(d.$,{variant:"RECOMMENDED"===f?"default":"outline",onClick:()=>h("RECOMMENDED"),children:"推薦服務"}),Object.entries(C).map(e=>{let[s,r]=e;return(0,i.jsx)(d.$,{variant:f===s?"default":"outline",onClick:()=>h(s),children:r},s)})]}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:M.map(e=>(0,i.jsxs)("div",{className:"border rounded-lg p-6 space-y-4 bg-white shadow-sm",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold",children:e.name}),e.isRecommended&&(0,i.jsx)(k,{variant:"secondary",children:"推薦"})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(k,{variant:"outline",children:"SINGLE"===e.type?"單人服務":"組合服務"}),(0,i.jsx)(k,{className:O[e.category],children:C[e.category]})]})]}),(0,i.jsx)("div",{className:"flex space-x-2",children:r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>E(e),children:(0,i.jsx)(w.A,{className:"h-4 w-4"})}),(0,i.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>j(e.id),children:(0,i.jsx)(v.A,{className:"h-4 w-4"})})]})})]}),(0,i.jsx)("p",{className:"text-gray-600",children:e.description}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h3",{className:"font-medium",children:"服務時長與價格："}),e.durations.map(e=>(0,i.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,i.jsxs)("span",{children:[e.duration," 分鐘"]}),(0,i.jsxs)("span",{children:["$",e.price]})]},e.id))]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-medium mb-2",children:"提供按摩師："}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2",children:e.masseurs.map(e=>(0,i.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded-full text-sm",children:e.masseur.name},e.masseur.id))})]})]},e.id))})]})}},3312:(e,s,r)=>{"use strict";r.d(s,{$:()=>c});var i=r(5155),a=r(2115),t=r(2317),n=r(1027),l=r(1567);let d=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,s)=>{let{className:r,variant:a,size:n,asChild:c=!1,...o}=e,m=c?t.DX:"button";return(0,i.jsx)(m,{className:(0,l.cn)(d({variant:a,size:n,className:r})),ref:s,...o})});c.displayName="Button"},3900:(e,s,r)=>{"use strict";r.d(s,{p:()=>n});var i=r(5155),a=r(2115),t=r(1567);let n=a.forwardRef((e,s)=>{let{className:r,type:a,...n}=e;return(0,i.jsx)("input",{type:a,className:(0,t.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:s,...n})});n.displayName="Input"},8986:(e,s,r)=>{"use strict";r.d(s,{J:()=>c});var i=r(5155),a=r(2115),t=r(6195),n=r(1027),l=r(1567);let d=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,i.jsx)(t.b,{ref:s,className:(0,l.cn)(d(),r),...a})});c.displayName=t.b.displayName},6754:(e,s,r)=>{"use strict";r.d(s,{T:()=>n});var i=r(5155),a=r(2115),t=r(1567);let n=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,i.jsx)("textarea",{className:(0,t.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:s,...a})});n.displayName="Textarea"},8291:(e,s,r)=>{"use strict";function i(e){var s,r;return(null==e?void 0:null===(r=e.user)||void 0===r?void 0:null===(s=r.role)||void 0===s?void 0:s.toUpperCase())==="ADMIN"}r.d(s,{q:()=>i})},1567:(e,s,r)=>{"use strict";r.d(s,{cn:()=>t});var i=r(3463),a=r(9795);function t(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return(0,a.QP)((0,i.$)(s))}}},e=>{var s=s=>e(e.s=s);e.O(0,[374,615,40,321,441,517,358],()=>s(3755)),_N_E=e.O()}]);